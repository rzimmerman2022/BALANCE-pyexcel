fect—seeing the two owner folders laid out like that means you’re ready for the Power BI “From Folder” workflow.

1 ⃣ Decide where the data should live
Option	When to choose it	Steps
Keep inside the repo (what you have now)
…\BALANCE-pyexcel-repository\CSVs\{Owner}\*.csv	• You’re the only user
• You don’t plan to push the repo to GitHub (or you’ve already added /CSVs/ to .gitignore)	Nothing to move. Just remember to run process_pdfs.py … CSVs {Owner} so new files land in the same tree.
Move outside the repo (privacy-safe)	• You’ll eventually publish the repo
• You want a very slim repo history	1. mkdir C:\BALANCE_data\CSVs
2. robocopy CSVs C:\BALANCE_data\CSVs /E
3. Add to .gitignore:
  /CSVs/
  csv_inbox_real/

Either layout works with Power BI; just pick one and stick with it.

2 ⃣ Build the Power BI report

This section outlines two primary methods for getting your transaction data into Power BI.

**2a. Original Method: Connecting Directly to CSV Files via Folder**

Open Power BI Desktop → Get Data → Folder.
Browse to the folder that holds the owner sub-folders, e.g.
`…\BALANCE-pyexcel-repository\CSVs` or `C:\BALANCE_data\CSVs`.

In the dialog, click `Transform Data` (not Load).
This opens Power Query.

*   **Filter to the CSV files only**: In the preview table, keep rows where `Extension` = `.csv`.
*   **Remove columns you don’t need**: (e.g., `Size`, `Date accessed`, etc.).
*   **Combine / Transform → Combine Files**.
    Power BI will automatically:
    *   Read the first file as an example.
    *   Promote headers.
    *   Append all owner files into one query called `Combined`.

*   **Verify column types**:
    *   `TransDate` → Date
    *   `Amount` → Decimal number
    *   Leave `Owner`, `RawMerchant`, etc. as Text.

*   **Close & Apply**.
Now you’re in the report canvas with a single table of all transactions from your CSVs.

**2b. Connecting to `balance_final.parquet` via DuckDB ODBC (Recommended for Stage 2+ Users)**

This method leverages the canonical `balance_final.parquet` file generated by the BALANCE-pyexcel pipeline (Stage 2 onwards). It offers a direct connection to the cleaned and consolidated data.

**Prerequisites:**
*   **DuckDB ODBC Driver:** Ensure you have the [DuckDB ODBC driver](https://duckdb.org/docs/guides/odbc/overview.html) installed on the machine where Power BI Desktop is running.
*   **`balance_final.parquet`:** This file must have been generated by a successful run of the `balance-pyexcel` CLI. It's typically located in the same directory as your Excel workbook (e.g., `workbook/balance_final.parquet` relative to the project root if your workbook is in `workbook/`).

**Steps in Power BI Desktop:**
1.  **Get Data:** From the Home ribbon, click `Get Data` and select `ODBC`.
    *   *Screenshot placeholder: Power BI "Get Data" menu highlighting ODBC.*
2.  **Configure ODBC Connection:**
    *   In the ODBC dialog, choose your DuckDB DSN from the "Data source name (DSN)" dropdown if you have one configured.
    *   Alternatively, expand "Advanced options" and provide a connection string. A minimal connection string for querying Parquet files with an in-memory DuckDB instance is:
        ```
        Driver={DuckDB Driver};Database=:memory:;
        ```
        (Replace `{DuckDB Driver}` with the exact name of your installed DuckDB ODBC driver, e.g., "DuckDB Driver").
    *   *Screenshot placeholder: Power BI ODBC connection dialog with connection string example.*
3.  **Enter SQL Statement:** In the "SQL statement" box (still under "Advanced options"), enter the query to read your Parquet file. **Crucially, replace `'C:\path\to\your\workbook\folder\balance_final.parquet'` with the actual, full path to your `balance_final.parquet` file.**
    ```sql
    SELECT * FROM read_parquet('C:\path\to\your\workbook\folder\balance_final.parquet');
    ```
    *   *Screenshot placeholder: Power BI ODBC dialog showing SQL statement for read_parquet.*
4.  **Load Data:** Click `OK`. If prompted for credentials, default/anonymous authentication should work for local DuckDB access. The data will load, and Power Query Editor might open.
5.  **Verify Column Types:** In Power Query (if it opens, or by clicking "Transform data" on the loaded table), check that data types are correctly inferred (e.g., `Date` as Date/DateTime, `Amount` as Decimal Number, `SplitPercent` as Decimal Number). Adjust if necessary.
6.  **Close & Apply.**

**Advantages:**
*   Directly uses the single, canonical, and cleaned `balance_final.parquet` file.
*   Avoids manual steps in Power Query for combining multiple CSV files or promoting headers.
*   Leverages the full, normalized dataset including `TxnID`, `CanonMerchant`, `SharedFlag`, `SplitPercent`, etc.
*   Potentially faster for very large datasets.

Once the data is loaded using either method, you can proceed to create visuals.

3 ⃣ Create the visuals
Visual	How
Month-over-Month Spend	Clustered column or line chart. Axis = Year-Month (build a Date hierarchy from the `Date` column or create a custom “yyyy-mm” column). Values = Sum of `Amount` (set conditional colour if negative).
Top 10 Merchants (current month)	Add a slicer for Year-Month, then a Top N horizontal bar chart: Axis = RawMerchant, Value = Sum Amount, filter Top 10.
Credits vs Charges Donut	Create a grouping field (e.g., ChargeCredit = if [Amount] < 0 then "Charge" else "Credit"), then a donut visual with Sum Amount.
KPI Cards	Four Card visuals: Sum Charges, Sum Credits, Net (Sum), Distinct count of RawMerchant. Use teal (#00A6A6) for the primary colour.
Slicers	Add slicers for Owner, AccountLast4, and Year-Month.

Tip: turn on “Sync slicers” so the same filters apply across pages if you create additional sheets.

4 ⃣ (Optional) Dynamic “sheet” per owner
Power BI doesn’t create new pages on refresh, but you can replicate the Excel feel:

Method A – Bookmarks

Duplicate the page for each owner.

Pre-filter each page to one owner via the slicer, then lock it.

Rename the page tabs “Jordyn”, “Ryan”, …

Method B – One page + slicer

Keep a single page with a slicer for Owner.

Users pick the owner they want; the visuals update instantly.

5 ⃣ Refresh workflow
Run your PDF-to-CSV pipeline (e.g., `process_pdfs.py` or the full `balance-pyexcel` CLI) to generate/update your source files (CSVs or `balance_final.parquet`).

Open the .pbix file and click `Refresh` on the Home ribbon (or schedule refresh if you later use Power BI Service).

*   If using the **CSV Folder method (2a)**, Power BI re-scans the folder and combines files.
*   If using the **Parquet/ODBC method (2b)**, Power BI re-executes the DuckDB query against the (potentially updated) `balance_final.parquet` file.

Everything updates—no VBA, no COM automation required for the data ingestion into Power BI itself.

Quick recap
*   Keep (or move) your CSVs folder, or rely on the `balance_final.parquet` file generated by the pipeline.
*   Use Get Data → Folder (for CSVs) or Get Data → ODBC (for Parquet via DuckDB).
*   Build modern visuals with slicers and KPI cards using the rich dataset.
*   Refresh is one click in Power BI Desktop. Done!

Let me know if you’d like screenshots or a step-by-step GIF of the Power Query setup.
