# Power BI Integration Guide

This page shows two ways to bring **BALANCE-pyexcel** data into Power BI:

1. **Folder import** – combine raw CSVs directly (fastest to set up).  
2. **DuckDB + Parquet** – query the canonical `balance_final.parquet` (cleaner for large data & Stage-2 users).

---

## 1  Decide where the CSVs live

| Layout | Pick this when… | Typical path | Setup notes |
|--------|-----------------|--------------|-------------|
| **Inside the repo** | • You’re the only user<br>• You won’t push CSVs to GitHub **or** `/CSVs/` is already in *.gitignore* | `…\BALANCE-pyexcel-repository\CSVs\<Owner>\*.csv` | *No action* – just keep dropping files there. |
| **Outside the repo** | • You’ll publish the code publicly<br>• You want a slim commit history | `C:\BALANCE_data\CSVs\<Owner>\*.csv` | ```cmd<br>mkdir C:\BALANCE_data\CSVs<br>robocopy CSVs C:\BALANCE_data\CSVs /E```<br>Add to *.gitignore*: <br>`/CSVs/`<br>`csv_inbox_real/` |

Either structure works with the steps below—just stay consistent.

---

## 2  Build the Power BI report

### 2 a **Original method:** Folder → Combine CSVs

1. **Get Data → Folder**  
   Browse to the parent folder that contains the *Owner* sub-folders (e.g., `…\CSVs`).

2. Click **Transform Data** (don’t hit *Load* yet).

3. In Power Query:  
   * Filter `Extension = .csv`.  
   * Remove unneeded columns (`Size`, `Date accessed`, …).  
   * Home → **Combine / Transform → Combine Files**.  
   * Power BI auto-promotes headers and appends everything into a query called *Combined*.

4. Set column types:  
   | Column | Type |
   |--------|------|
   | `Date` | Date |
   | `Amount` | Decimal number |
   | Others (`Owner`, `RawMerchant`, …) | Text |

5. **Close & Apply** – the data model is ready.

---

### 2 b **Recommended (Stage 2+):** DuckDB ODBC → `balance_final.parquet`

This taps the fully normalized, de-duplicated dataset your CLI already produces.

#### Prerequisites

* **DuckDB ODBC driver** installed.  
* A fresh `balance_final.parquet` (generated by `balance-pyexcel`).

#### Steps

1. **Get Data → ODBC**  
2. In the dialog:  
   * Choose your *DuckDB* DSN **or** supply a connection string:  
     ```text
     Driver=DuckDB Driver;Database=:memory:;
     ```
3. Expand **Advanced options** → paste SQL:  
   ```sql
   SELECT * 
   FROM read_parquet('C:\\BALANCE_data\\balance_final.parquet');
Replace the path with the real location of your Parquet file.

Click OK → anonymous credentials are fine for local files.

Verify data types in Power Query, then Close & Apply.

Why this is nicer

One file, no header-promotion wizardry.

Includes all canonical fields (TxnID, CanonMerchant, SharedFlag, …).

Faster refresh for big datasets (> 50 k rows).

3 Build visuals (starter set)
Visual	How-to
Month-over-Month Spend	Line or clustered column. Axis = Year-Month (use Date hierarchy or a custom "yyyy-MM" column). Values = Sum Amount (set conditional color if negative).
Top-10 Merchants (current month)	Add a slicer on Year-Month, then a Top N bar chart – Axis = RawMerchant, Values = Sum Amount, filter Top 10.
Charges vs Credits Donut	Create a calc column: ChargeCredit = if [Amount] < 0 then "Charge" else "Credit". Use in a donut visual.
KPI Cards	4 Card visuals: Sum Charges, Sum Credits, Net, Distinct Merchant Count.
Slicers	Add for Owner, AccountLast4, Year-Month; turn on Sync slicers if you add extra pages.

4 Optional: owner-specific “sheets”
Bookmarks method: Duplicate the page, pre-filter each copy to one Owner, lock the slicer, rename tabs “Jordyn”, “Ryan”, etc.

Single-page method: One page + an Owner slicer the user can toggle.

5 Refresh workflow
Step	CSV Folder method	Parquet/ODBC method
1 Run pipeline	process_pdfs.py or balance-pyexcel CLI → writes new CSVs	Same CLI → overwrites balance_final.parquet
2 Refresh in Power BI	Click Refresh – Power Query re-scans folder & appends	Click Refresh – DuckDB query re-reads the Parquet
3 Review visuals	Everything updates – no VBA or COM needed	Ditto

Recap
Decide on CSV folder vs Parquet—both are one-click refresh in Power BI.

Folder method: Get Data → Folder → Combine Files wizard.

Parquet method: Get Data → ODBC → read_parquet() SQL (needs DuckDB driver).

Build visuals with slicers and KPI cards; sync slicers for a dashboard feel.

Need screenshots or a GIF walkthrough? Open an issue or ping me on Slack!

yaml
Copy
Edit

---

### How to wire this into the docs

1. Save as `docs/powerbi_integration.md`.  
2. Append to **mkdocs.yml** under *Architecture Overview*:

   ```yaml
   nav:
     - Architecture Overview: architecture.md
     - Power BI Integration: powerbi_integration.md     # <– new
Commit & push—MkDocs will rebuild with the new sidebar entry.