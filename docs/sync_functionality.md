# Sync Functionality

*Keep manual Excel decisions in lock-step with your automated pipeline.*

---

## Why do we need a sync step?

Some decisions—“Is this a shared expense?” “Should we split 60 / 40?”—are quicker in Excel than code.  
The **Queue_Review** sheet lets any household member mark up transactions;  
`sync_review_decisions()` reads those choices back into the canonical dataset so Power BI and future runs stay consistent.

---

## 1  Queue_Review sheet format

| Column | Purpose |
|--------|---------|
| **TxnID** | Deterministic ID generated by the pipeline. |
| **Set Shared?** (`Y`, `N`, `S`) | `Y` = shared, `N` = personal, `S` = split by % |
| **Set Split %** (0-100) | Only used when “S” is chosen. |

---

## 2  Decision rules

| Scenario | What the sync code does |
|----------|------------------------|
| Value not in `Y / N / S` | Ignore & log a warning |
| “S” but % blank | Assume **50 %** |
| % < 0 or > 100 | Clamp to 0 – 100 |
| Empty row | Skip |

---

## 3  Data flow

Transactions (Parquet / SQLite)
│
▼
Excel » Queue_Review
│
▼
sync_review_decisions()
• Validate
• Clean
• Merge
• Update SharedFlag / SplitPercent
│
▼
Updated Transactions

yaml
Copy
Edit

---

## 4  Using the sync in code

```python
from balance_pipeline.sync import sync_review_decisions
import pandas as pd

txns  = pd.read_parquet("balance_final.parquet")
queue = pd.read_excel("workbook.xlsx", sheet_name="Queue_Review")

txns_updated = sync_review_decisions(txns, queue)
txns_updated.to_parquet("balance_final.parquet", index=False)
5 Excel workflow
Open Queue_Review.

Fill Set Shared? with Y, N, or S.

If S, enter Set Split %.

Click your Refresh button (or run the macro).

The Transactions sheet updates; Power BI reflects the change on next refresh.

6 Error handling highlights
Missing sheets / columns → logged and skipped, original data returned.

Empty frames → no-op with info log.

Type coercion → ensures % becomes numeric, flags become nullable Boolean.

Non-destructive → all original columns preserved; only SharedFlag, SplitPercent mutate.

Where to put this page
Save as docs/sync_review.md.

Add to mkdocs.yml under Developer Guide (or wherever you prefer):

yaml
Copy
Edit
  - Developer Guide:
      - Environment Setup: developer_setup.md
      - CLI Usage: cli_usage.md
      - Sync Review Sheet: sync_review.md        # ← new
Commit & push, and your docs site will pick it up on the next build.
Ping me if you’d like deeper examples or expanded logging docs!