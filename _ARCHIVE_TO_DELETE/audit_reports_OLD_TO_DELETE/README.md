# Audit Reports Directory

This folder contains comprehensive audit trails and balance summaries generated by the CTS (Canonical Transaction Schema) pipeline.

## File Types

### Complete Audit Trail (`complete_audit_trail_*.csv`)
- **Size**: ~370KB (3,622 rows, 14 columns)
- **Content**: Every transaction with full rationale, context, and running balances
- **Columns**:
  - `person`: Ryan or Jordyn
  - `date`: Transaction date (chronologically sorted)
  - `merchant`: Merchant/vendor name
  - `full_description`: **Complete original description/notes from source CSV**
  - `actual_amount`: Amount actually paid
  - `allowed_amount`: Amount allocated to this person
  - `net_effect`: Net impact on balance (allowed - actual)
  - `pattern_flags`: Detected patterns (e.g., "multiplier_2x", "rent")
  - `calculation_notes`: Rationale for allocation (e.g., "SR | Standard 50/50 split")
  - `transaction_type`: Type (standard, rent)
  - `source_file`: Original CSV source (consistent naming)
  - `transaction_id`: Sequential transaction number (1-3622)
  - `running_balance_ryan`: **Ryan's cumulative balance after this transaction**
  - `running_balance_jordyn`: **Jordyn's cumulative balance after this transaction**

### Balance Summary (`balance_summary_*.csv`)
- **Size**: ~50 bytes (2 rows)
- **Content**: Final net balance per person
- **Columns**:
  - `person`: Ryan or Jordyn
  - `net_owed`: Total amount owed (positive) or credit (negative)

## File Naming Convention

Files are automatically timestamped when generated:
- Format: `YYYYMMDD_HHMMSS`
- Example: `complete_audit_trail_20250622_204808.csv`

## How to Generate New Reports

### Option 1: Quick Generation
```bash
python scripts/generate_audit_report.py
```

### Option 2: Manual Generation
```python
from src.balance_pipeline.data_loader import load_all_data
from src.baseline_analyzer import baseline_math as bm

df = load_all_data(pathlib.Path('data'))
summary_df, audit_df = bm.build_baseline(df)
# Files automatically saved to audit_reports/
```

## Current Status

- **Total Transactions**: 1,669 (from 4 CSV sources)
- **Audit Rows**: 3,622 (each transaction creates Ryan + Jordyn entries)
- **Balance**: $921 imbalance (business logic review needed)
- **Sources**: Expense_History (1,130), Transaction_Ledger (397), Rent_Allocation (92), Rent_History (50)

## Data Quality Notes

The audit trail reveals:
1. **Architecture**: ✅ CTS schema working perfectly
2. **Data Loading**: ✅ All 4 CSV formats processed successfully  
3. **Business Logic**: ⚠️ $921 imbalance suggests Transaction_Ledger allocation rules need review

The imbalance is likely due to Transaction_Ledger having `allowed_amount=0` when it should equal `actual_amount` for personal expenses.
